[tools]
node = "lts"

[tasks.dev]
description = "Start the development server"
run = "npm run dev"

[tasks.build]
description = "Build for production"
run = "npm run build"

[tasks.start]
description = "Start production server"
run = "npm run start"

[tasks.lint]
description = "Run ESLint and fix issues"
run = "npm run lint -- --fix"

[tasks.test]
description = "Run tests"
run = "npm test"

[tasks."test:watch"]
description = "Run tests in watch mode"
run = "npm run test:watch"

[tasks."test:coverage"]
description = "Run tests with coverage report"
run = "npm run test:coverage"

[tasks."test:e2e"]
description = "Run Playwright end-to-end tests"
run = "npx playwright test"

[tasks."test:e2e:ui"]
description = "Run Playwright tests in UI mode"
run = "npx playwright test --ui"

[tasks."test:e2e:headed"]
description = "Run Playwright tests in headed mode"
run = "npx playwright test --headed"

[tasks."db:generate"]
description = "Generate Prisma Client"
run = "npm run db:generate"

[tasks."db:push"]
description = "Push schema changes to database"
run = "npm run db:push"

[tasks."db:migrate"]
description = "Run database migrations"
run = "npm run db:migrate"

[tasks."db:studio"]
description = "Open Prisma Studio"
run = "npm run db:studio"

[tasks.install]
description = "Install dependencies"
run = "npm install"

[tasks.setup]
description = "Initial project setup"
run = [
  "mise run install",
  "mise run db:generate",
  "mise run db:push"
]

[tasks."db:reset"]
description = "Reset the database (delete and recreate)"
run = "SKIP_SEED=true npx prisma migrate reset"

[tasks.ci]
description = "Run CI checks (matches GitHub Actions workflow)"
run = [
  "npm ci",
  "npx prisma generate",
  "npm run lint",
  "npm run build"
]

[tasks."bot:discord"]
description = "Run the Discord bot"
run = "npm run bot:discord"

[tasks."register-discord-metadata"]
description = "Register Discord role connection metadata schema (required before using role_connections.write scope)"
run = "npm run register-discord-metadata"
